@startuml CURA_ERD

!define ENTITY entity
!define PK <b><color:red>PK</color></b>
!define FK <b><color:blue>FK</color></b>

skinparam backgroundColor #FAFAFA
skinparam entity {
    BackgroundColor #E8F4FD
    BorderColor #2196F3
    FontSize 12
}

ENTITY "RFID_CHIPS" as rfid {
    PK id : INTEGER
    chip_id : VARCHAR(50)
    wochentag : VARCHAR(20)
    aktiv : BOOLEAN
    --
    CHECK: wochentag IN ('MONTAG'...'SONNTAG')
    DEFAULT: aktiv = true
}

ENTITY "ORTE" as orte {
    PK id : INTEGER
    strasse : VARCHAR(255) <<NOT NULL>>
    hausnummer : VARCHAR(10) <<NOT NULL>>
    postleitzahl : VARCHAR(10) <<NOT NULL>>
    stadt : VARCHAR(100) <<NOT NULL>>
    stockwerk : VARCHAR(10)
}

ENTITY "MEDIKAMENTE" as medikamente {
    PK id : INTEGER
    name : VARCHAR(255) <<NOT NULL>>
    wirkstoff : VARCHAR(255)
}

ENTITY "PFLEGER" as pfleger {
    PK id : INTEGER
    name : VARCHAR(255) <<NOT NULL>>
    telefonnummer : VARCHAR(50)
    email : VARCHAR(255)
    FK ort_id : INTEGER
}

ENTITY "PATIENTEN" as patienten {
    PK id : INTEGER
    name : VARCHAR(255) <<NOT NULL>>
    alter : INTEGER
    FK ort_id : INTEGER
    telefonnummer : VARCHAR(50)
    email : VARCHAR(255)
    --
    CHECK: 0 < alter < 150
}

ENTITY "MEDIKAMENTENPLAENE" as medplan {
    PK id : INTEGER
    FK patient_id : INTEGER <<NOT NULL>>
    FK medikament_id : INTEGER <<NOT NULL>>
    FK pfleger_id : INTEGER
    wochentage_flags : INTEGER
    tageszeiten_flags : INTEGER
    stueckzahl : INTEGER
    gueltig_von : DATE <<NOT NULL>>
    gueltig_bis : DATE
    notizen : TEXT
    aktiv : BOOLEAN
    --
    CHECK: wochentage_flags 0-127
    CHECK: tageszeiten_flags 0-15
    CHECK: stueckzahl > 0
    DEFAULT: aktiv = true
}

' Relationships (1:N)
orte ||--o{ pfleger : "arbeitet_an"
orte ||--o{ patienten : "wohnt_in"
patienten ||--o{ medplan : "hat"
medikamente ||--o{ medplan : "verwendet_in"
pfleger ||--o{ medplan : "betreut"

note top of rfid : RFID für\nWochentag-Erkennung

note right of medplan : **Binäre Flags System:**\n• **Wochentage (0-127):**\n  So=1, Mo=2, Di=4, Mi=8,\n  Do=16, Fr=32, Sa=64\n• **Tageszeiten (0-15):**\n  Morgens=1, Mittags=2,\n  Nachmittags=4, Abends=8\n\n**Beispiele:**\n• Täglich: 127\n• Werktags: 62\n• Mo+Mi+Fr: 42\n• Morgens+Abends: 9

note bottom of orte : Adressen für\nPatienten & Pfleger

@enduml