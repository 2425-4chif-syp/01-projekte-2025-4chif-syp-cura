<header>
  <h1>CURA</h1>
  <div class="user-info">
    <div class="user-line">
      <i class="fa-solid fa-user"></i>
      <span class="user-name">{{ userName }}</span>
    </div>
    <div class="date-line">
      <span class="user-date">{{ currentDate }}</span>
      <button (click)="logout()" class="btn-logout" title="Abmelden">
        <i class="fa-solid fa-right-from-bracket"></i>
      </button>
    </div>
  </div>
</header>

<main>
  <div class="main-layout">
    <!-- Left Column: Kalender und Einnahmequote -->
    <div class="left-column">
      <aside class="calendar-card" [class.flipped]="showDayDetail">
        <div class="calendar-inner">
          <!-- Calendar Front -->
          <div class="calendar-front">
            <h2>{{ currentMonth }}</h2>
            <div class="weekdays">
              <span>Mo</span>
              <span>Di</span>
              <span>Mi</span>
              <span>Do</span>
              <span>Fr</span>
              <span>Sa</span>
              <span>So</span>
            </div>
            <div class="calendar-grid">
              @for (day of calendarDays; track day.date) {
                <div class="day" 
                     [class.checked]="day.checked" 
                     [class.partial]="day.partial" 
                     [class.missed]="day.missed" 
                     [class.no-data]="!day.checked && !day.partial && !day.missed && day.day > 0"
                     (click)="openDayDetail(day)">
                  <span>{{ day.day }}</span>
                </div>
              }
            </div>
          </div>
          
          <!-- Day Detail Back -->
          <div class="calendar-back">
            <div class="day-detail-header">
              <h2>{{ selectedDay ? getFormattedDate(selectedDay.date) : '' }}</h2>
              <button class="btn-close" (click)="closeDayDetail()">
                <i class="fa-solid fa-xmark"></i>
              </button>
            </div>
            
            <div class="day-detail-content">
              @if (selectedDayMedications.length === 0) {
                <p class="no-medications">Keine Medikamente für diesen Tag geplant</p>
              } @else {
                @for (med of selectedDayMedications; track $index) {
                  <div class="medication-item" [class.taken]="med.status === 'taken'" [class.missed]="med.status === 'missed'">
                    <div class="medication-time">
                      <i class="fa-solid fa-clock"></i>
                      <span>{{ med.timeLabel }}</span>
                    </div>
                    <div class="medication-name">
                      <span>{{ med.medication }}</span>
                    </div>
                  </div>
                }
              }
            </div>
          </div>
        </div>
      </aside>

      <div class="income-quote">
        <h3>Einnahme quote {{ currentMonth }}</h3>

        <div class="progress-bar">
          <div class="progress-segment checked" [style.width.%]="checkedPercentage"></div>
          <div class="progress-segment partial" [style.width.%]="partialPercentage"></div>
          <div class="progress-segment missed" [style.width.%]="missedPercentage"></div>
        </div>
        <p></p>
        <div class="status-labels">
          <span class="status-label">
            <span class="status-dot checked"></span> Eingenommen: {{ checkedPercentage }}%
          </span>
          <!--<span class="status-label">
            <span class="status-dot partial"></span> Teilweise: {{ partialPercentage }}%
          </span> -->
          <span class="status-label">
            <span class="status-dot missed"></span> Verpasst: {{ missedPercentage }}%
          </span>
        </div>
      </div>
    </div>

    <!-- Medikamentenplan - Desktop Version (alle Tage) -->
    <section class="medication-card desktop-medication">
      <h2>Medikamentenplan 1</h2>
      <table class="medication-table">
        <thead>
          <tr>
            <th class="time-label"></th>
            <th>Mo</th>
            <th>Di</th>
            <th>Mi</th>
            <th>Do</th>
            <th>Fr</th>
            <th>Sa</th>
            <th>So</th>
          </tr>
        </thead>
        <tbody>
          @for (row of medicationRows; track $index) {
            <tr>
              <td class="time-label">{{ row.timeLabel }}</td>
              @for (cell of row.days; track $index) {
                <td>{{ cell }}</td>
              }
            </tr>
          }
        </tbody>
      </table>
      <div class="action-buttons">
        <button class="btn-primary">ändern</button>
        <button class="btn-secondary">exportieren</button>
      </div>
    </section>

    <!-- Medikamentenplan - Mobile Version (nur aktueller Tag) -->
    <section class="medication-card mobile-medication">
      <h2>Medikamentenplan 1 - {{ currentDayName }}</h2>
      <table class="medication-table">
        <thead>
          <tr>
            <th class="time-label">Uhrzeit</th>
            <th>Medikament</th>
          </tr>
        </thead>
        <tbody>
          @for (row of medicationRows; track $index) {
            <tr>
              <td class="time-label">{{ row.timeLabel }}</td>
              <td>{{ row.days[currentDayIndex] }}</td>
            </tr>
          }
        </tbody>
      </table>
      <div class="action-buttons">
        <button class="btn-primary">ändern</button>
        <button class="btn-secondary">exportieren</button>
      </div>
    </section>
  </div>
</main>