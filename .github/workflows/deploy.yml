name: Deploy to VM12

on:
  push:
    branches:
      - main
    paths:
      - 'web/**'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Deploy to VM12 - File-based Version
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: vm12.htl-leonding.ac.at
        username: curaadm
        password: ${{ secrets.VM12_PASSWORD }}
        script: |
          echo "ðŸš€ Starting file-based deployment..."
          
          # Remove old files
          sudo rm -f /var/www/html/index.nginx-debian.html*
          sudo rm -f /var/www/html/index.html
          
          # Clone repo to temp directory
          cd /tmp
          rm -rf cura-deploy
          git clone https://github.com/2425-4chif-syp/01-projekte-2025-4chif-syp-cura.git cura-deploy
          
          # Copy the HTML file from your web directory
          sudo cp /tmp/cura-deploy/web/index.html /var/www/html/
          
          # Set permissions
          sudo chown www-data:www-data /var/www/html/index.html
          sudo chmod 644 /var/www/html/index.html
          
          # Clean up
          rm -rf /tmp/cura-deploy
          
          # Reload nginx
          sudo nginx -t
          sudo systemctl reload nginx
          
          # Verify deployment
          echo "âœ… Files in /var/www/html/:"
          ls -la /var/www/html/
          
          echo "ðŸ“„ Content verification (first 10 lines):"
          head -10 /var/www/html/index.html
          
          echo "ðŸŽ‰ File-based deployment completed! Your changes from web/index.html are now live!"